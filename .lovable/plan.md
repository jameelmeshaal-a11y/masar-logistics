

# خطة التطوير الشاملة لنظام إدارة اللوجستيات

## المرحلة 1: تفعيل Lovable Cloud وقاعدة البيانات

### جداول قاعدة البيانات
سيتم انشاء الجداول التالية مع سياسات RLS:

- **profiles** - بيانات المستخدمين (الاسم، الصورة، الهاتف)
- **user_roles** - جدول الصلاحيات (admin, manager, viewer, driver, warehouse_keeper, mechanic)
- **trucks** - بيانات الشاحنات
- **tires** - بيانات الكفرات
- **drivers** - بيانات السائقين
- **requisitions** - طلبات الاحتياج
- **purchase_orders** - اوامر الشراء
- **purchase_order_items** - بنود اوامر الشراء
- **vendors** - الموردين
- **invoices** - الفواتير
- **work_orders** - اوامر العمل والصيانة
- **inventory_items** - اصناف المخزون
- **inventory_movements** - حركة المخزون
- **payments** - المدفوعات
- **quality_inspections** - فحوصات الجودة
- **chat_messages** - رسائل المحادثات
- **chat_rooms** - غرف المحادثات
- **barcodes** - نظام الباركود لكل اصل وصنف

### المستخدم الادمن
- انشاء المستخدم ceo@salasah.sa مع كلمة المرور admin@2030
- اضافة حماية في قاعدة البيانات تمنع حذف او تعطيل هذا المستخدم
- ربطه بدور admin في جدول user_roles

---

## المرحلة 2: نظام المستخدمين والصلاحيات

### صفحة تسجيل الدخول
- واجهة تسجيل دخول احترافية بالعربية
- دعم اعادة تعيين كلمة المرور

### صفحة ادارة المستخدمين (/settings/users)
- اضافة/تعديل/حذف المستخدمين (ما عدا الادمن)
- تعيين الادوار لكل مستخدم

### مصفوفة الصلاحيات
| الصلاحية | Admin | Manager | Viewer | Driver | Warehouse | Mechanic |
|----------|-------|---------|--------|--------|-----------|----------|
| لوحة التحكم | كامل | كامل | قراءة | قراءة | قراءة | قراءة |
| المشتريات | كامل | كامل | قراءة | - | قراءة | - |
| الاسطول | كامل | كامل | قراءة | قراءة | - | قراءة |
| الصيانة | كامل | كامل | قراءة | - | - | كامل |
| المستودعات | كامل | كامل | قراءة | - | كامل | قراءة |
| السائقين | كامل | كامل | قراءة | قراءة | - | - |
| المالية | كامل | كامل | قراءة | - | - | - |
| التقارير | كامل | كامل | قراءة | قراءة | قراءة | قراءة |
| الاعدادات | كامل | - | - | - | - | - |

---

## المرحلة 3: نماذج الادخال (Modals/Forms)

سيتم تفعيل جميع ازرار "اضافة" بنماذج ادخال داخل Dialog:

1. **نموذج طلب احتياج** - القسم، الصنف، الكمية، الملاحظات
2. **نموذج امر شراء** - المورد، البنود، الكميات، الاسعار
3. **نموذج اضافة شاحنة** - رقم اللوحة، الموديل، النوع، السائق
4. **نموذج اضافة كفر** - الرقم التسلسلي، الماركة، المقاس، الشاحنة
5. **نموذج امر عمل** - الشاحنة، النوع، الوصف، الاولوية
6. **نموذج اضافة صنف** - الرمز، الاسم، التصنيف، الكمية، الحد الادنى
7. **نموذج اضافة سائق** - الاسم، رقم الهوية، الرخصة، الهاتف
8. **نموذج اضافة مورد** - الاسم، الرقم الضريبي، الهاتف
9. **نموذج تسجيل دفعة** - المورد، الفاتورة، المبلغ، طريقة الدفع
10. **نموذج فحص جودة** - الشاحنة، النوع، الفاحص، البنود

كل نموذج يتضمن:
- تحقق من صحة البيانات (Zod validation)
- رسائل خطا واضحة بالعربية
- حفظ مباشر في قاعدة البيانات

---

## المرحلة 4: الرسوم البيانية التفاعلية

### لوحة التحكم (Dashboard)
- **رسم بياني دائري** - توزيع حالات الشاحنات (الوان: اخضر زاهي، برتقالي، احمر)
- **رسم بياني خطي** - تكاليف الصيانة الشهرية (تدرجات زرقاء وبنفسجية)
- **رسم بياني شريطي** - اداء الموردين (الوان قوس قزح)
- **رسم بياني مساحي** - حركة المخزون (تدرجات خضراء وذهبية)

### صفحة التقارير
- رسوم بيانية لكل تقرير عند النقر على "عرض"
- بيانات تجريبية واقعية لكل تقرير
- امكانية تصفية التقارير بالفترة الزمنية

### الالوان المستخدمة
الوان زاهية وبراقة: فيروزي (#06D6A0)، بنفسجي (#7B2FF7)، وردي (#FF6B8A)، ذهبي (#FFD166)، ازرق سماوي (#4ECDC4)، برتقالي (#FF8A5C)

---

## المرحلة 5: نظام الباركود

- اضافة عمود barcode_id لجداول (trucks, tires, inventory_items)
- توليد باركود تلقائي لكل اصل وصنف عند الاضافة
- عرض الباركود كصورة SVG في بطاقة كل اصل
- زر طباعة الباركود
- مكتبة تستخدم: توليد الباركود عبر كود SVG مباشر (بدون مكتبة خارجية)

---

## المرحلة 6: نظام الثيمات

### اضافة 4 ثيمات قابلة للتبديل:
1. **كلاسيكي** (الحالي) - ازرق داكن وبرتقالي
2. **محيطي** - تدرجات الازرق والفيروزي
3. **صحراوي** - ذهبي وبني رملي
4. **داكن** - الوضع المظلم الحالي محسن

### التنفيذ
- اضافة زر تبديل الثيمات في الشريط العلوي
- حفظ الثيم المختار في localStorage
- CSS variables لكل ثيم في index.css

---

## المرحلة 7: جاهزية الربط مع ERPNext/Frappe

### البنية التحتية
- انشاء ملف تكوين ERPNext (src/lib/erpnext-config.ts)
- انشاء طبقة API موحدة (src/lib/erpnext-api.ts) تحتوي:
  - دوال مزامنة البيانات
  - تحويل البيانات بين تنسيق النظام وتنسيق ERPNext
  - Mapping لكل DocType في ERPNext

### DocTypes المدعومة
- Purchase Order ← اوامر الشراء
- Supplier ← الموردين
- Item ← الاصناف
- Stock Entry ← حركة المخزون
- Maintenance Visit ← اوامر الصيانة
- Vehicle ← الشاحنات
- Employee ← السائقين

### صفحة اعدادات الربط (/settings/erpnext)
- ادخال رابط سيرفر ERPNext
- ادخال API Key و Secret
- زر اختبار الاتصال
- جدول المزامنة (يدوي/تلقائي)

---

## ملخص الملفات المتاثرة

### ملفات جديدة (حوالي 20 ملف):
- صفحة تسجيل الدخول، اعادة تعيين كلمة المرور
- صفحة ادارة المستخدمين والصلاحيات
- صفحة اعدادات ERPNext
- نماذج ادخال لكل قسم (10 نماذج)
- مكون الباركود
- مكون تبديل الثيمات
- ملفات مساعدة (hooks, contexts, utils)

### ملفات معدلة:
- جميع صفحات الاقسام (لاضافة النماذج والرسوم البيانية)
- AppLayout.tsx (اضافة الثيمات والصلاحيات)
- App.tsx (اضافة المسارات الجديدة وحماية المسارات)
- index.css (اضافة متغيرات الثيمات)
- Dashboard.tsx (اضافة الرسوم البيانية)

---

## التفاصيل التقنية

- قاعدة البيانات: Lovable Cloud (Supabase)
- المصادقة: Supabase Auth مع email/password
- الرسوم البيانية: Recharts (مثبتة مسبقا)
- التحقق من البيانات: Zod + React Hook Form
- ادارة الحالة: React Query للبيانات من قاعدة البيانات
- الباركود: توليد SVG مباشر
- الثيمات: CSS Variables مع localStorage

